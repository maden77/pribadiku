<!DOCTYPE html>
<html ng-app="notesApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catatan</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, #4A90E2, #9013FE);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        /* Login Section */
        .login-section {
            padding: 40px 25px;
            background: #f8f9fa;
            text-align: center;
        }
        
        .login-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        
        .login-box h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .login-box p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .seed-phrase-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            min-height: 100px;
            resize: vertical;
            font-family: monospace;
        }
        
        .seed-phrase-input:focus {
            outline: none;
            border-color: #4A90E2;
        }
        
        .info-box {
            background: #e8f4fc;
            border-left: 4px solid #4A90E2;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
            border-radius: 5px;
        }
        
        .info-box h4 {
            color: #4A90E2;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .info-box ul {
            padding-left: 20px;
            color: #555;
        }
        
        .info-box li {
            margin-bottom: 5px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #4A90E2, #9013FE);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-danger {
            background: #ff4757;
            color: white;
        }
        
        .btn-danger:hover {
            background: #ff3742;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .input-section {
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        input, textarea {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #4A90E2;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .notes-section {
            padding: 25px;
        }
        
        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .notes-header h2 {
            color: #333;
        }
        
        .notes-count {
            background: #4A90E2;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .notes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .note-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 5px solid #4A90E2;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.12);
        }
        
        .note-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            word-break: break-word;
        }
        
        .note-content {
            color: #555;
            line-height: 1.5;
            margin-bottom: 15px;
            word-break: break-word;
        }
        
        .note-date {
            font-size: 12px;
            color: #888;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .note-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .empty-notes {
            text-align: center;
            padding: 40px;
            color: #888;
            grid-column: 1 / -1;
        }
        
        .empty-notes i {
            font-size: 50px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .filter-section {
            margin-bottom: 20px;
        }
        
        .filter-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #eaeaea;
            border-radius: 8px;
            font-size: 16px;
        }
        
        /* Message Styles */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* Debug info */
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 12px;
            color: #666;
            border-left: 3px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container" ng-controller="NotesController as vm">
        <!-- Header -->
        <div class="header" ng-if="vm.isLoggedIn">
            <button class="btn logout-btn" ng-click="vm.logout()">üö™ Logout</button>
            <h1>üìù Aplikasi Catatan </h1>
            
            <p><small>User ID: {{vm.userId}}</small></p>
        </div>
        
        <!-- Login Section (Tampil jika belum login) -->
        <div class="login-section" ng-if="!vm.isLoggedIn">
            <div class="login-box">
                <h2>üîê Login dengan Seed Phrase</h2>
                <p>Masukkan seed phrase 12 kata untuk mengakses catatan Anda</p>
                
                <div class="message message-info" ng-if="vm.showInfo">
                    <strong>Info:</strong> Untuk pertama kali login, gunakan seed phrase default:<br>
                    <code style="display: block; padding: 10px; background: #f5f5f5; margin: 10px 0; border-radius: 5px; font-family: monospace;">
                        word1 word2 word3 word4 word5 word6 word7 word8 word9 word10 word11 word12
                    </code>
                </div>
                
                <div class="message" ng-class="{'message-success': vm.loginMessage.type === 'success', 'message-error': vm.loginMessage.type === 'error', 'message-info': vm.loginMessage.type === 'info'}" 
                     ng-if="vm.loginMessage.text">
                    {{vm.loginMessage.text}}
                </div>
                
                <textarea class="seed-phrase-input" 
                          ng-model="vm.seedPhrase" 
                          placeholder="Masukkan 12 kata"
                          ng-keyup="$event.keyCode === 13 && vm.login()"></textarea>
                
                <div class="info-box">
                    <h4>üìå Cara Kerja:</h4>
                    <ul>
                        <li><strong>Pertama kali:</strong> Gunakan seed phrase default di atas</li>
                        <li><strong>Catatan penting:</strong> Data disimpan berdasarkan seed phrase yang digunakan</li>
                        <li>Gunakan seed phrase yang sama untuk mengakses data yang sama</li>
                        <li>Seed phrase berbeda = data berbeda</li>
                    </ul>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button class="btn btn-primary" ng-click="vm.login()">
                        üîë Login
                    </button>
                    <button class="btn btn-secondary" ng-click="vm.generateSeedPhrase()">
                        üé≤ Generate Seed Baru
                    </button>
                </div>
                
                <div class="debug-info" ng-if="vm.debugMode">
                    <strong>Debug Info:</strong><br>
                    Seed phrase: {{vm.seedPhrase}}<br>
                    User ID: {{vm.userId}}<br>
                    Notes count: {{vm.notes.length}}
                </div>
            </div>
        </div>
        
        <!-- Aplikasi Catatan (Tampil jika sudah login) -->
        <div ng-if="vm.isLoggedIn">
            <!-- Input Catatan Baru -->
            <div class="input-section">
                <div class="input-group">
                    <input type="text" ng-model="vm.newNote.title" placeholder="Judul catatan..." maxlength="100">
                    <textarea ng-model="vm.newNote.content" placeholder="Isi catatan... (maksimal 500 karakter)" maxlength="500"></textarea>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" ng-click="vm.addNote()" ng-disabled="!vm.newNote.title || !vm.newNote.content">
                            ‚ûï Tambah Catatan
                        </button>
                        <button class="btn btn-secondary" ng-click="vm.debugMode = !vm.debugMode">
                            üîß Debug
                        </button>
                    </div>
                </div>
                
                <div class="message message-info" ng-if="vm.debugMode">
                    <strong>Debug Mode Aktif</strong><br>
                    User ID: {{vm.userId}}<br>
                    Total Catatan: {{vm.notes.length}}<br>
                    Storage Key: notes_{{vm.userId}}
                </div>
            </div>
            
            <!-- Filter Catatan -->
            <div class="filter-section">
                <input type="text" class="filter-input" ng-model="vm.searchText" placeholder="üîç Cari catatan berdasarkan judul atau isi...">
            </div>
            
            <!-- Daftar Catatan -->
            <div class="notes-section">
                <div class="notes-header">
                    <h2>Catatan Saya</h2>
                    <div class="notes-count">{{vm.getFilteredNotes().length}} catatan</div>
                </div>
                
                <div class="notes-container">
                    <!-- Jika tidak ada catatan -->
                    <div class="empty-notes" ng-if="vm.getFilteredNotes().length === 0">
                        <div>üìÑ</div>
                        <h3 ng-if="!vm.searchText">Belum ada catatan</h3>
                        <h3 ng-if="vm.searchText">Tidak ada catatan yang cocok dengan pencarian</h3>
                        <p ng-if="!vm.searchText">Mulai dengan menambahkan catatan pertama Anda di atas!</p>
                    </div>
                    
                    <!-- Kartu Catatan -->
                    <div class="note-card" ng-repeat="note in vm.getFilteredNotes() track by $index">
                        <div class="note-title">{{note.title}}</div>
                        <div class="note-date">{{note.date | date:'dd MMMM yyyy, HH:mm'}}</div>
                        <div class="note-content">{{note.content}}</div>
                        <div class="note-actions">
                            <button class="btn btn-danger" ng-click="vm.deleteNote($index)">üóëÔ∏è Hapus</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        angular.module('notesApp', [])
        .controller('NotesController', function($scope, $timeout) {
            var vm = this;
            
            // Status login
            vm.isLoggedIn = false;
            vm.userId = '';
            vm.seedPhrase = '';
            vm.showInfo = true;
            vm.debugMode = false;
            
            // Pesan login
            vm.loginMessage = {
                text: '',
                type: ''
            };
            
            // Data catatan baru
            vm.newNote = {
                title: '',
                content: ''
            };
            
            // Data catatan
            vm.notes = [];
            
            // Teks untuk pencarian
            vm.searchText = '';
            
            // Default seed phrase untuk demo
            var DEFAULT_SEED = 'word1 word2 word3 word4 word5 word6 word7 word8 word9 word10 word11 word12';
            
            // Fungsi untuk menampilkan pesan
            vm.showMessage = function(text, type, duration) {
                vm.loginMessage.text = text;
                vm.loginMessage.type = type;
                
                if (duration) {
                    $timeout(function() {
                        vm.loginMessage.text = '';
                        vm.loginMessage.type = '';
                    }, duration);
                }
            };
            
            // Generate user ID dari seed phrase
            vm.generateUserId = function(seedPhrase) {
                // Buat hash sederhana dari seed phrase
                var hash = 0;
                for (var i = 0; i < seedPhrase.length; i++) {
                    hash = ((hash << 5) - hash) + seedPhrase.charCodeAt(i);
                    hash = hash & hash;
                }
                return 'user_' + Math.abs(hash).toString(16).substring(0, 8);
            };
            
            // Generate seed phrase acak
            vm.generateSeedPhrase = function() {
                var wordList = [
                    'abandon', 'ability', 'able', 'about', 'above', 'absent', 'absorb', 'abstract', 'absurd', 'abuse',
                    'access', 'accident', 'account', 'accuse', 'achieve', 'acid', 'acoustic', 'acquire', 'across', 'act',
                    'action', 'actor', 'actress', 'actual', 'adapt', 'add', 'addict', 'address', 'adjust', 'admit',
                    'adult', 'advance', 'advice', 'aerobic', 'affair', 'afford', 'afraid', 'again', 'age', 'agent'
                ];
                
                var seedWords = [];
                for (var i = 0; i < 12; i++) {
                    var randomIndex = Math.floor(Math.random() * wordList.length);
                    seedWords.push(wordList[randomIndex]);
                }
                
                vm.seedPhrase = seedWords.join(' ');
                vm.showMessage('Seed phrase baru berhasil digenerate! Salin dan simpan dengan aman.', 'success', 5000);
            };
            
            // Validasi seed phrase
            vm.validateSeedPhrase = function(phrase) {
                var words = phrase.trim().split(/\s+/);
                
                // Cek jumlah kata
                if (words.length !== 12) {
                    return {
                        valid: false,
                        message: 'Seed phrase harus terdiri dari 12 kata'
                    };
                }
                
                // Cek kata kosong
                for (var i = 0; i < words.length; i++) {
                    if (!words[i]) {
                        return {
                            valid: false,
                            message: 'Terdapat kata kosong dalam seed phrase'
                        };
                    }
                }
                
                return {
                    valid: true,
                    words: words
                };
            };
            
            // Fungsi login
            vm.login = function() {
                var validation = vm.validateSeedPhrase(vm.seedPhrase);
                
                if (!validation.valid) {
                    // Coba dengan default seed phrase jika kosong
                    if (!vm.seedPhrase.trim()) {
                        vm.seedPhrase = DEFAULT_SEED;
                        validation = vm.validateSeedPhrase(vm.seedPhrase);
                        if (!validation.valid) {
                            vm.showMessage('Gunakan seed phrase default atau generate baru', 'error', 3000);
                            return;
                        }
                    } else {
                        vm.showMessage(validation.message, 'error', 3000);
                        return;
                    }
                }
                
                // Generate user ID dari seed phrase
                vm.userId = vm.generateUserId(vm.seedPhrase);
                
                // Login berhasil
                vm.isLoggedIn = true;
                vm.showInfo = false;
                
                // Load catatan dari localStorage
                vm.loadNotesFromStorage();
                
                // Jika tidak ada catatan, tambahkan contoh
                if (vm.notes.length === 0) {
                    vm.notes = [
                        {
                            title: 'Selamat Datang!',
                            content: 'Catatan Anda tersimpan dengan aman.',
                            date: new Date()
                        },
                        
                    ];
                    vm.saveNotesToStorage();
                    vm.showMessage('Akun baru dibuat dengan seed phrase ini!', 'success', 3000);
                } else {
                    vm.showMessage('Login berhasil! Memuat ' + vm.notes.length + ' catatan', 'success', 2000);
                }
            };
            
            // Fungsi untuk load catatan dari localStorage
            vm.loadNotesFromStorage = function() {
                try {
                    var storageKey = 'notes_' + vm.userId;
                    var storedNotes = localStorage.getItem(storageKey);
                    
                    if (storedNotes) {
                        vm.notes = JSON.parse(storedNotes);
                        // Convert date strings back to Date objects
                        vm.notes = vm.notes.map(function(note) {
                            note.date = new Date(note.date);
                            return note;
                        });
                    } else {
                        vm.notes = [];
                    }
                } catch (e) {
                    console.error('Error loading notes:', e);
                    vm.notes = [];
                }
            };
            
            // Fungsi untuk menyimpan catatan ke localStorage
            vm.saveNotesToStorage = function() {
                if (!vm.isLoggedIn || !vm.userId) return;
                
                try {
                    var storageKey = 'notes_' + vm.userId;
                    localStorage.setItem(storageKey, JSON.stringify(vm.notes));
                } catch (e) {
                    console.error('Error saving notes:', e);
                    vm.showMessage('Gagal menyimpan catatan', 'error', 2000);
                }
            };
            
            // Fungsi logout
            vm.logout = function() {
                vm.isLoggedIn = false;
                vm.seedPhrase = '';
                vm.notes = [];
                vm.newNote = { title: '', content: '' };
                vm.searchText = '';
                vm.userId = '';
                vm.showMessage('Anda telah logout', 'info', 2000);
            };
            
            // Fungsi untuk menambah catatan baru
            vm.addNote = function() {
                if (vm.newNote.title && vm.newNote.content) {
                    vm.notes.push({
                        title: vm.newNote.title,
                        content: vm.newNote.content,
                        date: new Date()
                    });
                    
                    // Reset form
                    vm.newNote.title = '';
                    vm.newNote.content = '';
                    
                    // Simpan ke storage
                    vm.saveNotesToStorage();
                    
                    // Tampilkan pesan sukses
                    vm.showMessage('Catatan berhasil ditambahkan!', 'success', 2000);
                }
            };
            
            // Fungsi untuk menghapus catatan
            vm.deleteNote = function(index) {
                if (confirm('Apakah Anda yakin ingin menghapus catatan ini?')) {
                    var deletedNote = vm.notes[index];
                    vm.notes.splice(index, 1);
                    vm.saveNotesToStorage();
                    vm.showMessage('Catatan "' + deletedNote.title + '" berhasil dihapus!', 'success', 2000);
                }
            };
            
            // Fungsi untuk mendapatkan catatan yang sudah difilter
            vm.getFilteredNotes = function() {
                if (!vm.searchText) {
                    return vm.notes;
                }
                
                var searchLower = vm.searchText.toLowerCase();
                return vm.notes.filter(function(note) {
                    return note.title.toLowerCase().includes(searchLower) || 
                           note.content.toLowerCase().includes(searchLower);
                });
            };
            
            // Cek jika ada session yang masih aktif
            var checkExistingSession = function() {
                var lastUserId = localStorage.getItem('last_user_id');
                if (lastUserId) {
                    vm.showMessage('Silakan login dengan seed phrase yang sesuai', 'info');
                    vm.showInfo = false;
                }
            };
            
            // Initialize
            checkExistingSession();
            
            // Watch untuk auto-save catatan
            $scope.$watch(function() {
                return vm.notes;
            }, function(newVal, oldVal) {
                if (vm.isLoggedIn && newVal !== oldVal) {
                    vm.saveNotesToStorage();
                }
            }, true);
        })
        .filter('date', function() {
            return function(input) {
                if (!input) return '';
                
                var date = new Date(input);
                var options = { 
                    day: '2-digit', 
                    month: 'long', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                
                return date.toLocaleDateString('id-ID', options);
            };
        });
    </script>
</body>
</html>